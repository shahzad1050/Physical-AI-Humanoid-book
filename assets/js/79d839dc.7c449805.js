"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[9584],{1023:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"module2/lab-first-simulation","title":"Practical Lab: Creating Your First Robot Simulation","description":"Objective","source":"@site/docs/module2/lab-first-simulation.md","sourceDirName":"module2","slug":"/module2/lab-first-simulation","permalink":"/Physical-AI-Humanoid-book/docs/module2/lab-first-simulation","draft":false,"unlisted":false,"editUrl":"https://github.com/user/physical-ai-humanoid-robotics/tree/main/docs/module2/lab-first-simulation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Introduction to Robot Simulation","permalink":"/Physical-AI-Humanoid-book/docs/module2/introduction"},"next":{"title":"Physics and Sensor Simulation","permalink":"/Physical-AI-Humanoid-book/docs/module2/physics-sensor-simulation"}}');var s=i(4848),a=i(8453);const o={},r="Practical Lab: Creating Your First Robot Simulation",l={},c=[{value:"Objective",id:"objective",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create a New ROS 2 Package",id:"step-1-create-a-new-ros-2-package",level:2},{value:"Step 2: Create the Robot URDF Model",id:"step-2-create-the-robot-urdf-model",level:2},{value:"Step 3: Create a Gazebo World File",id:"step-3-create-a-gazebo-world-file",level:2},{value:"Step 4: Create a Robot State Publisher Node",id:"step-4-create-a-robot-state-publisher-node",level:2},{value:"Step 5: Create a Simple Controller Node",id:"step-5-create-a-simple-controller-node",level:2},{value:"Step 6: Create Launch Files",id:"step-6-create-launch-files",level:2},{value:"Step 7: Update setup.py",id:"step-7-update-setuppy",level:2},{value:"Step 8: Build and Run the Simulation",id:"step-8-build-and-run-the-simulation",level:2},{value:"Step 9: Test and Monitor",id:"step-9-test-and-monitor",level:2},{value:"Step 10: Advanced Testing",id:"step-10-advanced-testing",level:2},{value:"Expected Results",id:"expected-results",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Extensions",id:"extensions",level:2},{value:"Summary",id:"summary",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"practical-lab-creating-your-first-robot-simulation",children:"Practical Lab: Creating Your First Robot Simulation"})}),"\n",(0,s.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,s.jsx)(n.p,{children:"In this lab, you will create a complete robot simulation environment using Gazebo and ROS 2. You will design a simple mobile robot, create its URDF model, set up a Gazebo world, and implement basic control and sensing capabilities."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ROS 2 Humble Hawksbill installed"}),"\n",(0,s.jsx)(n.li,{children:"Gazebo (Harmonic or compatible version)"}),"\n",(0,s.jsx)(n.li,{children:"Basic knowledge of URDF and ROS 2 concepts"}),"\n",(0,s.jsx)(n.li,{children:"Terminal/command line familiarity"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-1-create-a-new-ros-2-package",children:"Step 1: Create a New ROS 2 Package"}),"\n",(0,s.jsx)(n.p,{children:"First, create a workspace and package for your simulation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create workspace directory\nmkdir -p ~/ros2_simulation_ws/src\ncd ~/ros2_simulation_ws/src\n\n# Create a new package for the robot simulation\nros2 pkg create --build-type ament_python robot_simulation_pkg --dependencies rclpy std_msgs geometry_msgs sensor_msgs gazebo_ros_pkgs gazebo_ros\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-2-create-the-robot-urdf-model",children:"Step 2: Create the Robot URDF Model"}),"\n",(0,s.jsx)(n.p,{children:"Create the directory structure for your robot model:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create URDF directory\nmkdir -p ~/ros2_simulation_ws/src/robot_simulation_pkg/urdf\n\n# Create meshes directory\nmkdir -p ~/ros2_simulation_ws/src/robot_simulation_pkg/meshes\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Create the main robot URDF file ",(0,s.jsx)(n.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/urdf/my_robot.urdf"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<robot name="my_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">\n  \x3c!-- Properties --\x3e\n  <xacro:property name="M_PI" value="3.1415926535897931" />\n\n  \x3c!-- Robot base --\x3e\n  <link name="base_link">\n    <visual>\n      <geometry>\n        <cylinder length="0.2" radius="0.3"/>\n      </geometry>\n      <material name="blue">\n        <color rgba="0 0 1 1"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <cylinder length="0.2" radius="0.3"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="10.0"/>\n      <inertia\n        ixx="0.425" ixy="0.0" ixz="0.0"\n        iyy="0.425" iyz="0.0"\n        izz="0.9"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Left wheel --\x3e\n  <link name="wheel_left">\n    <visual>\n      <geometry>\n        <cylinder length="0.05" radius="0.1"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0 0 0 1"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <cylinder length="0.05" radius="0.1"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="1.0"/>\n      <inertia\n        ixx="0.001" ixy="0.0" ixz="0.0"\n        iyy="0.001" iyz="0.0"\n        izz="0.002"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Right wheel --\x3e\n  <link name="wheel_right">\n    <visual>\n      <geometry>\n        <cylinder length="0.05" radius="0.1"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0 0 0 1"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <cylinder length="0.05" radius="0.1"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="1.0"/>\n      <inertia\n        ixx="0.001" ixy="0.0" ixz="0.0"\n        iyy="0.001" iyz="0.0"\n        izz="0.002"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Castor wheel (for stability) --\x3e\n  <link name="caster_wheel">\n    <visual>\n      <geometry>\n        <sphere radius="0.05"/>\n      </geometry>\n      <material name="gray">\n        <color rgba="0.5 0.5 0.5 1"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <sphere radius="0.05"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="0.1"/>\n      <inertia\n        ixx="0.0001" ixy="0.0" ixz="0.0"\n        iyy="0.0001" iyz="0.0"\n        izz="0.0001"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Joints --\x3e\n  <joint name="base_to_left_wheel" type="continuous">\n    <parent link="base_link"/>\n    <child link="wheel_left"/>\n    <origin xyz="0 0.25 -0.05" rpy="${M_PI/2} 0 0"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  <joint name="base_to_right_wheel" type="continuous">\n    <parent link="base_link"/>\n    <child link="wheel_right"/>\n    <origin xyz="0 -0.25 -0.05" rpy="${M_PI/2} 0 0"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  <joint name="base_to_caster" type="fixed">\n    <parent link="base_link"/>\n    <child link="caster_wheel"/>\n    <origin xyz="0.2 0 -0.1" rpy="0 0 0"/>\n  </joint>\n\n  \x3c!-- Gazebo plugins --\x3e\n  <gazebo>\n    \x3c!-- Differential drive plugin --\x3e\n    <plugin name="differential_drive" filename="libgazebo_ros_diff_drive.so">\n      <left_joint>base_to_left_wheel</left_joint>\n      <right_joint>base_to_right_wheel</right_joint>\n      <wheel_separation>0.5</wheel_separation>\n      <wheel_diameter>0.2</wheel_diameter>\n      <max_wheel_torque>20</max_wheel_torque>\n      <max_wheel_acceleration>1.0</max_wheel_acceleration>\n      <command_topic>cmd_vel</command_topic>\n      <odometry_topic>odom</odometry_topic>\n      <odometry_frame>odom</odometry_frame>\n      <robot_base_frame>base_link</robot_base_frame>\n      <publish_odom>true</publish_odom>\n      <publish_wheel_tf>true</publish_wheel_tf>\n      <publish_odom_tf>true</publish_odom_tf>\n    </plugin>\n  </gazebo>\n\n  \x3c!-- Gazebo materials and properties --\x3e\n  <gazebo reference="base_link">\n    <material>Gazebo/Blue</material>\n  </gazebo>\n\n  <gazebo reference="wheel_left">\n    <material>Gazebo/Black</material>\n  </gazebo>\n\n  <gazebo reference="wheel_right">\n    <material>Gazebo/Black</material>\n  </gazebo>\n\n  <gazebo reference="caster_wheel">\n    <material>Gazebo/Grey</material>\n  </gazebo>\n</robot>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"step-3-create-a-gazebo-world-file",children:"Step 3: Create a Gazebo World File"}),"\n",(0,s.jsx)(n.p,{children:"Create the worlds directory and a simple world file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_simulation_ws/src/robot_simulation_pkg/worlds\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/worlds/simple_room.world"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" ?>\n<sdf version="1.7">\n  <world name="simple_room">\n    \x3c!-- Include ground plane --\x3e\n    <include>\n      <uri>model://ground_plane</uri>\n    </include>\n\n    \x3c!-- Include sun --\x3e\n    <include>\n      <uri>model://sun</uri>\n    </include>\n\n    \x3c!-- Simple room with walls --\x3e\n    <model name="wall_1">\n      <pose>-5 0 2.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box>\n              <size>0.1 10 5</size>\n            </box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box>\n              <size>0.1 10 5</size>\n            </box>\n          </geometry>\n          <material>\n            <ambient>0.8 0.8 0.8 1</ambient>\n            <diffuse>0.8 0.8 0.8 1</diffuse>\n          </material>\n        </visual>\n        <inertial>\n          <mass>100</mass>\n          <inertia>\n            <ixx>1</ixx>\n            <ixy>0</ixy>\n            <ixz>0</ixz>\n            <iyy>1</iyy>\n            <iyz>0</iyz>\n            <izz>1</izz>\n          </inertia>\n        </inertial>\n      </link>\n    </model>\n\n    <model name="wall_2">\n      <pose>5 0 2.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box>\n              <size>0.1 10 5</size>\n            </box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box>\n              <size>0.1 10 5</size>\n            </box>\n          </geometry>\n          <material>\n            <ambient>0.8 0.8 0.8 1</ambient>\n            <diffuse>0.8 0.8 0.8 1</diffuse>\n          </material>\n        </visual>\n        <inertial>\n          <mass>100</mass>\n          <inertia>\n            <ixx>1</ixx>\n            <ixy>0</ixy>\n            <ixz>0</ixz>\n            <iyy>1</iyy>\n            <iyz>0</iyz>\n            <izz>1</izz>\n          </inertia>\n        </inertial>\n      </link>\n    </model>\n\n    <model name="wall_3">\n      <pose>0 -5 2.5 0 0 1.5707</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box>\n              <size>0.1 10 5</size>\n            </box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box>\n              <size>0.1 10 5</size>\n            </box>\n          </geometry>\n          <material>\n            <ambient>0.8 0.8 0.8 1</ambient>\n            <diffuse>0.8 0.8 0.8 1</diffuse>\n          </material>\n        </visual>\n        <inertial>\n          <mass>100</mass>\n          <inertia>\n            <ixx>1</ixx>\n            <ixy>0</ixy>\n            <ixz>0</ixz>\n            <iyy>1</iyy>\n            <iyz>0</iyz>\n            <izz>1</izz>\n          </inertia>\n        </inertial>\n      </link>\n    </model>\n\n    <model name="wall_4">\n      <pose>0 5 2.5 0 0 1.5707</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box>\n              <size>0.1 10 5</size>\n            </box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box>\n              <size>0.1 10 5</size>\n            </box>\n          </geometry>\n          <material>\n            <ambient>0.8 0.8 0.8 1</ambient>\n            <diffuse>0.8 0.8 0.8 1</diffuse>\n          </material>\n        </visual>\n        <inertial>\n          <mass>100</mass>\n          <inertia>\n            <ixx>1</ixx>\n            <ixy>0</ixy>\n            <ixz>0</ixz>\n            <iyy>1</iyy>\n            <iyz>0</iyz>\n            <izz>1</izz>\n          </inertia>\n        </inertial>\n      </link>\n    </model>\n\n    \x3c!-- Add some obstacles --\x3e\n    <model name="obstacle_1">\n      <pose>2 2 0.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <box>\n              <size>1 1 1</size>\n            </box>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <box>\n              <size>1 1 1</size>\n            </box>\n          </geometry>\n          <material>\n            <ambient>1 0 0 1</ambient>\n            <diffuse>1 0 0 1</diffuse>\n          </material>\n        </visual>\n        <inertial>\n          <mass>10</mass>\n          <inertia>\n            <ixx>1</ixx>\n            <ixy>0</ixy>\n            <ixz>0</ixz>\n            <iyy>1</iyy>\n            <iyz>0</iyz>\n            <izz>1</izz>\n          </inertia>\n        </inertial>\n      </link>\n    </model>\n\n    <model name="obstacle_2">\n      <pose>-2 -2 0.5 0 0 0</pose>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <cylinder>\n              <radius>0.5</radius>\n              <length>1</length>\n            </cylinder>\n          </geometry>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <cylinder>\n              <radius>0.5</radius>\n              <length>1</length>\n            </cylinder>\n          </geometry>\n          <material>\n            <ambient>0 1 0 1</ambient>\n            <diffuse>0 1 0 1</diffuse>\n          </material>\n        </visual>\n        <inertial>\n          <mass>5</mass>\n          <inertia>\n            <ixx>1</ixx>\n            <ixy>0</ixy>\n            <ixz>0</ixz>\n            <iyy>1</iyy>\n            <iyz>0</iyz>\n            <izz>1</izz>\n          </inertia>\n        </inertial>\n      </link>\n    </model>\n\n    \x3c!-- Physics configuration --\x3e\n    <physics type="ode">\n      <max_step_size>0.001</max_step_size>\n      <real_time_factor>1</real_time_factor>\n      <real_time_update_rate>1000</real_time_update_rate>\n      <ode>\n        <solver>\n          <type>quick</type>\n          <iters>10</iters>\n          <sor>1.3</sor>\n        </solver>\n        <constraints>\n          <cfm>0.0</cfm>\n          <erp>0.2</erp>\n          <contact_max_correcting_vel>100.0</contact_max_correcting_vel>\n          <contact_surface_layer>0.001</contact_surface_layer>\n        </constraints>\n      </ode>\n    </physics>\n  </world>\n</sdf>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"step-4-create-a-robot-state-publisher-node",children:"Step 4: Create a Robot State Publisher Node"}),"\n",(0,s.jsx)(n.p,{children:"Create a Python node to publish the robot state:"}),"\n",(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/robot_simulation_pkg/robot_state_publisher.py"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\n\"\"\"\nRobot State Publisher Node\nPublishes joint states for visualization\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom geometry_msgs.msg import TransformStamped\nfrom tf2_ros import TransformBroadcaster\nimport math\n\n\nclass RobotStatePublisher(Node):\n    def __init__(self):\n        super().__init__('robot_state_publisher')\n\n        # Create publisher for joint states\n        self.joint_pub = self.create_publisher(JointState, 'joint_states', 10)\n\n        # Create transform broadcaster\n        self.tf_broadcaster = TransformBroadcaster(self)\n\n        # Create timer for publishing\n        self.timer = self.create_timer(0.05, self.publish_joint_states)  # 20 Hz\n\n        # Initialize joint positions\n        self.wheel_left_pos = 0.0\n        self.wheel_right_pos = 0.0\n\n        self.get_logger().info('Robot State Publisher started')\n\n    def publish_joint_states(self):\n        # Create joint state message\n        msg = JointState()\n        msg.name = ['base_to_left_wheel', 'base_to_right_wheel']\n        msg.position = [self.wheel_left_pos, self.wheel_right_pos]\n        msg.velocity = [0.0, 0.0]\n        msg.effort = [0.0, 0.0]\n\n        # Set timestamp\n        msg.header.stamp = self.get_clock().now().to_msg()\n        msg.header.frame_id = 'base_link'\n\n        # Publish joint states\n        self.joint_pub.publish(msg)\n\n        # Broadcast transforms\n        self.broadcast_transforms()\n\n        # Update wheel positions (simulated motion)\n        self.wheel_left_pos += 0.01\n        self.wheel_right_pos += 0.01\n\n    def broadcast_transforms(self):\n        # Publish transform for base_link to odom (if available)\n        try:\n            # This would come from odometry in a real system\n            t = TransformStamped()\n            t.header.stamp = self.get_clock().now().to_msg()\n            t.header.frame_id = 'odom'\n            t.child_frame_id = 'base_link'\n            t.transform.translation.x = 0.0\n            t.transform.translation.y = 0.0\n            t.transform.translation.z = 0.0\n            t.transform.rotation.x = 0.0\n            t.transform.rotation.y = 0.0\n            t.transform.rotation.z = 0.0\n            t.transform.rotation.w = 1.0\n\n            self.tf_broadcaster.sendTransform(t)\n        except Exception as e:\n            self.get_logger().warn(f'Could not broadcast transform: {e}')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = RobotStatePublisher()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-5-create-a-simple-controller-node",children:"Step 5: Create a Simple Controller Node"}),"\n",(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/robot_simulation_pkg/simple_controller.py"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\n\"\"\"\nSimple Controller Node\nSubscribes to velocity commands and publishes them to the robot\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom sensor_msgs.msg import LaserScan\nimport math\n\n\nclass SimpleController(Node):\n    def __init__(self):\n        super().__init__('simple_controller')\n\n        # Create subscriber for velocity commands\n        self.cmd_sub = self.create_subscription(\n            Twist,\n            'cmd_vel',\n            self.cmd_vel_callback,\n            10\n        )\n\n        # Create subscriber for laser scan (for obstacle detection)\n        self.scan_sub = self.create_subscription(\n            LaserScan,\n            'scan',\n            self.scan_callback,\n            10\n        )\n\n        # Create publisher for velocity commands (in case we need to modify them)\n        self.cmd_pub = self.create_publisher(Twist, 'cmd_vel_out', 10)\n\n        # Parameters\n        self.declare_parameter('safety_distance', 0.5)\n        self.declare_parameter('max_linear_speed', 0.5)\n        self.declare_parameter('max_angular_speed', 1.0)\n\n        self.safety_distance = self.get_parameter('safety_distance').value\n        self.max_linear_speed = self.get_parameter('max_linear_speed').value\n        self.max_angular_speed = self.get_parameter('max_angular_speed').value\n\n        # Initialize variables\n        self.scan_data = None\n\n        self.get_logger().info('Simple Controller initialized')\n\n    def cmd_vel_callback(self, msg):\n        # Process the command (in this simple case, just log it)\n        self.get_logger().info(f'Received command: linear={msg.linear.x}, angular={msg.angular.z}')\n\n        # Check for obstacles and modify command if needed\n        if self.scan_data is not None:\n            modified_msg = self.avoid_obstacles(msg)\n            self.cmd_pub.publish(modified_msg)\n        else:\n            self.cmd_pub.publish(msg)\n\n    def scan_callback(self, msg):\n        # Store the latest scan data\n        self.scan_data = msg\n\n    def avoid_obstacles(self, original_cmd):\n        # Create a new command message\n        new_cmd = Twist()\n\n        # Check if there are obstacles in front\n        front_ranges = []\n        for i, distance in enumerate(self.scan_data.ranges):\n            if not math.isnan(distance) and not math.isinf(distance):\n                angle = self.scan_data.angle_min + i * self.scan_data.angle_increment\n                # Check front 60 degrees\n                if -math.pi/6 < angle < math.pi/6:\n                    front_ranges.append(distance)\n\n        if front_ranges and min(front_ranges) < self.safety_distance:\n            # Obstacle detected, stop and turn\n            new_cmd.linear.x = 0.0\n            new_cmd.angular.z = self.max_angular_speed\n            self.get_logger().warn(f'Obstacle detected at {min(front_ranges):.2f}m, turning!')\n        else:\n            # Path is clear, follow original command but with speed limits\n            new_cmd.linear.x = max(-self.max_linear_speed, min(self.max_linear_speed, original_cmd.linear.x))\n            new_cmd.angular.z = max(-self.max_angular_speed, min(self.max_angular_speed, original_cmd.angular.z))\n\n        return new_cmd\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = SimpleController()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-6-create-launch-files",children:"Step 6: Create Launch Files"}),"\n",(0,s.jsx)(n.p,{children:"Create the launch directory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_simulation_ws/src/robot_simulation_pkg/launch\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/launch/robot_simulation.launch.py"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription, ExecuteProcess\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution, TextSubstitution\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch_ros.actions import Node\nfrom ament_index_python.packages import get_package_share_directory\nimport os\n\n\ndef generate_launch_description():\n    # Package directory\n    pkg_dir = get_package_share_directory('robot_simulation_pkg')\n\n    # Launch arguments\n    use_sim_time = DeclareLaunchArgument(\n        'use_sim_time',\n        default_value='true',\n        description='Use simulation (Gazebo) clock if true'\n    )\n\n    world = DeclareLaunchArgument(\n        'world',\n        default_value='simple_room.world',\n        description='Choose one of the world files from `/robot_simulation_pkg/worlds`'\n    )\n\n    # Launch Gazebo server\n    gzserver = ExecuteProcess(\n        cmd=['gz', 'sim', '-r', PathJoinSubstitution([pkg_dir, 'worlds', LaunchConfiguration('world')])],\n        output='screen'\n    )\n\n    # Launch Gazebo client\n    gzclient = ExecuteProcess(\n        cmd=['gz', 'sim', '-g'],\n        output='screen'\n    )\n\n    # Robot State Publisher node\n    robot_state_publisher = Node(\n        package='robot_state_publisher',\n        executable='robot_state_publisher',\n        name='robot_state_publisher',\n        output='screen',\n        parameters=[{\n            'use_sim_time': LaunchConfiguration('use_sim_time'),\n            'robot_description': open(PathJoinSubstitution([pkg_dir, 'urdf', 'my_robot.urdf']).perform({})).read()\n        }]\n    )\n\n    # Spawn robot in Gazebo\n    spawn_entity = Node(\n        package='gazebo_ros',\n        executable='spawn_entity.py',\n        arguments=[\n            '-topic', 'robot_description',\n            '-entity', 'my_robot',\n            '-x', '0', '-y', '0', '-z', '0.1'\n        ],\n        output='screen'\n    )\n\n    # Robot State Publisher node (custom)\n    custom_robot_state_publisher = Node(\n        package='robot_simulation_pkg',\n        executable='robot_state_publisher',\n        name='custom_robot_state_publisher',\n        output='screen',\n        parameters=[{'use_sim_time': LaunchConfiguration('use_sim_time')}]\n    )\n\n    # Simple controller node\n    simple_controller = Node(\n        package='robot_simulation_pkg',\n        executable='simple_controller',\n        name='simple_controller',\n        output='screen',\n        parameters=[\n            {'use_sim_time': LaunchConfiguration('use_sim_time')},\n            {'safety_distance': 0.5},\n            {'max_linear_speed': 0.5},\n            {'max_angular_speed': 1.0}\n        ]\n    )\n\n    return LaunchDescription([\n        use_sim_time,\n        world,\n        gzserver,\n        # gzclient,  # Uncomment if you want the GUI\n        robot_state_publisher,\n        spawn_entity,\n        custom_robot_state_publisher,\n        simple_controller\n    ])\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-7-update-setuppy",children:"Step 7: Update setup.py"}),"\n",(0,s.jsxs)(n.p,{children:["Update the ",(0,s.jsx)(n.code,{children:"setup.py"})," file to include entry points:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from setuptools import setup\n\npackage_name = 'robot_simulation_pkg'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        ('share/' + package_name + '/urdf', ['urdf/my_robot.urdf']),\n        ('share/' + package_name + '/worlds', ['worlds/simple_room.world']),\n        ('share/' + package_name + '/launch', ['launch/robot_simulation.launch.py']),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='your.email@example.com',\n    description='Robot simulation package for lab exercise',\n    license='Apache License 2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'robot_state_publisher = robot_simulation_pkg.robot_state_publisher:main',\n            'simple_controller = robot_simulation_pkg.simple_controller:main',\n        ],\n    },\n)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-8-build-and-run-the-simulation",children:"Step 8: Build and Run the Simulation"}),"\n",(0,s.jsx)(n.p,{children:"Build your package:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_simulation_ws\ncolcon build --packages-select robot_simulation_pkg\nsource install/setup.bash\n"})}),"\n",(0,s.jsx)(n.p,{children:"Run the simulation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Launch the simulation\nros2 launch robot_simulation_pkg robot_simulation.launch.py\n\n# Terminal 2: Send velocity commands (after simulation is running)\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.5}, angular: {z: 0.2}}'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-9-test-and-monitor",children:"Step 9: Test and Monitor"}),"\n",(0,s.jsx)(n.p,{children:"Monitor various topics to see the simulation in action:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check joint states\nros2 topic echo /joint_states\n\n# Check odometry\nros2 topic echo /odom\n\n# Check laser scan data\nros2 topic echo /scan\n\n# Check TF transforms\nros2 run tf2_tools view_frames\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-10-advanced-testing",children:"Step 10: Advanced Testing"}),"\n",(0,s.jsx)(n.p,{children:"Try different commands to see how the robot responds:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Move forward\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.5}, angular: {z: 0.0}}' --times 10\n\n# Turn in place\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.0}, angular: {z: 0.5}}' --times 10\n\n# Square pattern\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.5}, angular: {z: 0.0}}' --times 10\nsleep 2\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.0}, angular: {z: 0.5}}' --times 10\n"})}),"\n",(0,s.jsx)(n.h2,{id:"expected-results",children:"Expected Results"}),"\n",(0,s.jsx)(n.p,{children:"When you run the simulation:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The Gazebo environment should start with your robot model"}),"\n",(0,s.jsx)(n.li,{children:"The robot should appear in the simple room world with walls and obstacles"}),"\n",(0,s.jsx)(n.li,{children:"When you send velocity commands, the robot should move in Gazebo"}),"\n",(0,s.jsx)(n.li,{children:"The robot should publish odometry data showing its position and orientation"}),"\n",(0,s.jsx)(n.li,{children:"The obstacle avoidance controller should respond to laser scan data"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.p,{children:"If you encounter issues:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Model not appearing"}),": Check that the URDF is valid and the spawn command is correct"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"No movement"}),": Verify that the differential drive plugin is properly configured"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TF errors"}),": Ensure the robot_state_publisher is running"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Gazebo crashes"}),": Try reducing physics complexity or increasing resources"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"extensions",children:"Extensions"}),"\n",(0,s.jsx)(n.p,{children:"To extend this simulation:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Add sensors"}),": Include camera, IMU, or other sensor models in the URDF"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Improve obstacle avoidance"}),": Implement more sophisticated navigation algorithms"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Add more complex environments"}),": Create larger, more detailed worlds"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Implement SLAM"}),": Add mapping and localization capabilities"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"In this lab, you have successfully:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Created a complete robot model in URDF format"}),"\n",(0,s.jsx)(n.li,{children:"Set up a Gazebo simulation environment"}),"\n",(0,s.jsx)(n.li,{children:"Implemented a basic control system with obstacle avoidance"}),"\n",(0,s.jsx)(n.li,{children:"Connected ROS 2 nodes to the simulation"}),"\n",(0,s.jsx)(n.li,{children:"Tested the system with various commands"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This provides a foundation for more complex robotic simulation scenarios and demonstrates the integration between ROS 2 and Gazebo for robotics development."})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var t=i(6540);const s={},a=t.createContext(s);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);