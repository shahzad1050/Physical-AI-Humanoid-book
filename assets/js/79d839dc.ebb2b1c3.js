"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[9584],{1023:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module2/lab-first-simulation","title":"Practical Lab: Creating Your First Robot Simulation","description":"Objective","source":"@site/docs/module2/lab-first-simulation.md","sourceDirName":"module2","slug":"/module2/lab-first-simulation","permalink":"/Physical-AI-Humanoid-book/docs/module2/lab-first-simulation","draft":false,"unlisted":false,"editUrl":"https://github.com/user/physical-ai-humanoid-robotics/tree/main/docs/module2/lab-first-simulation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Introduction to Robot Simulation","permalink":"/Physical-AI-Humanoid-book/docs/module2/introduction"},"next":{"title":"Physics and Sensor Simulation","permalink":"/Physical-AI-Humanoid-book/docs/module2/physics-sensor-simulation"}}');var t=n(4848),s=n(8453);const a={},o="Practical Lab: Creating Your First Robot Simulation",l={},c=[{value:"Objective",id:"objective",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create a New ROS 2 Package",id:"step-1-create-a-new-ros-2-package",level:2},{value:"Step 2: Create the Robot URDF Model",id:"step-2-create-the-robot-urdf-model",level:2},{value:"Step 3: Create a Gazebo World File",id:"step-3-create-a-gazebo-world-file",level:2},{value:"Step 4: Create a Robot State Publisher Node",id:"step-4-create-a-robot-state-publisher-node",level:2},{value:"Step 5: Create a Simple Controller Node",id:"step-5-create-a-simple-controller-node",level:2},{value:"Step 6: Create Launch Files",id:"step-6-create-launch-files",level:2},{value:"Step 7: Update setup.py",id:"step-7-update-setuppy",level:2},{value:"Step 8: Build and Run the Simulation",id:"step-8-build-and-run-the-simulation",level:2},{value:"Step 9: Test and Monitor",id:"step-9-test-and-monitor",level:2},{value:"Step 10: Advanced Testing",id:"step-10-advanced-testing",level:2},{value:"Expected Results",id:"expected-results",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Extensions",id:"extensions",level:2},{value:"Summary",id:"summary",level:2}];function m(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"practical-lab-creating-your-first-robot-simulation",children:"Practical Lab: Creating Your First Robot Simulation"})}),"\n",(0,t.jsx)(r.h2,{id:"objective",children:"Objective"}),"\n",(0,t.jsx)(r.p,{children:"In this lab, you will create a complete robot simulation environment using Gazebo and ROS 2. You will design a simple mobile robot, create its URDF model, set up a Gazebo world, and implement basic control and sensing capabilities."}),"\n",(0,t.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"ROS 2 Humble Hawksbill installed"}),"\n",(0,t.jsx)(r.li,{children:"Gazebo (Harmonic or compatible version)"}),"\n",(0,t.jsx)(r.li,{children:"Basic knowledge of URDF and ROS 2 concepts"}),"\n",(0,t.jsx)(r.li,{children:"Terminal/command line familiarity"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"step-1-create-a-new-ros-2-package",children:"Step 1: Create a New ROS 2 Package"}),"\n",(0,t.jsx)(r.p,{children:"First, create a workspace and package for your simulation:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Create workspace directory\r\nmkdir -p ~/ros2_simulation_ws/src\r\ncd ~/ros2_simulation_ws/src\r\n\r\n# Create a new package for the robot simulation\r\nros2 pkg create --build-type ament_python robot_simulation_pkg --dependencies rclpy std_msgs geometry_msgs sensor_msgs gazebo_ros_pkgs gazebo_ros\n"})}),"\n",(0,t.jsx)(r.h2,{id:"step-2-create-the-robot-urdf-model",children:"Step 2: Create the Robot URDF Model"}),"\n",(0,t.jsx)(r.p,{children:"Create the directory structure for your robot model:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Create URDF directory\r\nmkdir -p ~/ros2_simulation_ws/src/robot_simulation_pkg/urdf\r\n\r\n# Create meshes directory\r\nmkdir -p ~/ros2_simulation_ws/src/robot_simulation_pkg/meshes\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Create the main robot URDF file ",(0,t.jsx)(r.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/urdf/my_robot.urdf"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<robot name="my_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">\r\n  \x3c!-- Properties --\x3e\r\n  <xacro:property name="M_PI" value="3.1415926535897931" />\r\n\r\n  \x3c!-- Robot base --\x3e\r\n  <link name="base_link">\r\n    <visual>\r\n      <geometry>\r\n        <cylinder length="0.2" radius="0.3"/>\r\n      </geometry>\r\n      <material name="blue">\r\n        <color rgba="0 0 1 1"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <cylinder length="0.2" radius="0.3"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="10.0"/>\r\n      <inertia\r\n        ixx="0.425" ixy="0.0" ixz="0.0"\r\n        iyy="0.425" iyz="0.0"\r\n        izz="0.9"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  \x3c!-- Left wheel --\x3e\r\n  <link name="wheel_left">\r\n    <visual>\r\n      <geometry>\r\n        <cylinder length="0.05" radius="0.1"/>\r\n      </geometry>\r\n      <material name="black">\r\n        <color rgba="0 0 0 1"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <cylinder length="0.05" radius="0.1"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="1.0"/>\r\n      <inertia\r\n        ixx="0.001" ixy="0.0" ixz="0.0"\r\n        iyy="0.001" iyz="0.0"\r\n        izz="0.002"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  \x3c!-- Right wheel --\x3e\r\n  <link name="wheel_right">\r\n    <visual>\r\n      <geometry>\r\n        <cylinder length="0.05" radius="0.1"/>\r\n      </geometry>\r\n      <material name="black">\r\n        <color rgba="0 0 0 1"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <cylinder length="0.05" radius="0.1"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="1.0"/>\r\n      <inertia\r\n        ixx="0.001" ixy="0.0" ixz="0.0"\r\n        iyy="0.001" iyz="0.0"\r\n        izz="0.002"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  \x3c!-- Castor wheel (for stability) --\x3e\r\n  <link name="caster_wheel">\r\n    <visual>\r\n      <geometry>\r\n        <sphere radius="0.05"/>\r\n      </geometry>\r\n      <material name="gray">\r\n        <color rgba="0.5 0.5 0.5 1"/>\r\n      </material>\r\n    </visual>\r\n    <collision>\r\n      <geometry>\r\n        <sphere radius="0.05"/>\r\n      </geometry>\r\n    </collision>\r\n    <inertial>\r\n      <mass value="0.1"/>\r\n      <inertia\r\n        ixx="0.0001" ixy="0.0" ixz="0.0"\r\n        iyy="0.0001" iyz="0.0"\r\n        izz="0.0001"/>\r\n    </inertial>\r\n  </link>\r\n\r\n  \x3c!-- Joints --\x3e\r\n  <joint name="base_to_left_wheel" type="continuous">\r\n    <parent link="base_link"/>\r\n    <child link="wheel_left"/>\r\n    <origin xyz="0 0.25 -0.05" rpy="${M_PI/2} 0 0"/>\r\n    <axis xyz="0 0 1"/>\r\n  </joint>\r\n\r\n  <joint name="base_to_right_wheel" type="continuous">\r\n    <parent link="base_link"/>\r\n    <child link="wheel_right"/>\r\n    <origin xyz="0 -0.25 -0.05" rpy="${M_PI/2} 0 0"/>\r\n    <axis xyz="0 0 1"/>\r\n  </joint>\r\n\r\n  <joint name="base_to_caster" type="fixed">\r\n    <parent link="base_link"/>\r\n    <child link="caster_wheel"/>\r\n    <origin xyz="0.2 0 -0.1" rpy="0 0 0"/>\r\n  </joint>\r\n\r\n  \x3c!-- Gazebo plugins --\x3e\r\n  <gazebo>\r\n    \x3c!-- Differential drive plugin --\x3e\r\n    <plugin name="differential_drive" filename="libgazebo_ros_diff_drive.so">\r\n      <left_joint>base_to_left_wheel</left_joint>\r\n      <right_joint>base_to_right_wheel</right_joint>\r\n      <wheel_separation>0.5</wheel_separation>\r\n      <wheel_diameter>0.2</wheel_diameter>\r\n      <max_wheel_torque>20</max_wheel_torque>\r\n      <max_wheel_acceleration>1.0</max_wheel_acceleration>\r\n      <command_topic>cmd_vel</command_topic>\r\n      <odometry_topic>odom</odometry_topic>\r\n      <odometry_frame>odom</odometry_frame>\r\n      <robot_base_frame>base_link</robot_base_frame>\r\n      <publish_odom>true</publish_odom>\r\n      <publish_wheel_tf>true</publish_wheel_tf>\r\n      <publish_odom_tf>true</publish_odom_tf>\r\n    </plugin>\r\n  </gazebo>\r\n\r\n  \x3c!-- Gazebo materials and properties --\x3e\r\n  <gazebo reference="base_link">\r\n    <material>Gazebo/Blue</material>\r\n  </gazebo>\r\n\r\n  <gazebo reference="wheel_left">\r\n    <material>Gazebo/Black</material>\r\n  </gazebo>\r\n\r\n  <gazebo reference="wheel_right">\r\n    <material>Gazebo/Black</material>\r\n  </gazebo>\r\n\r\n  <gazebo reference="caster_wheel">\r\n    <material>Gazebo/Grey</material>\r\n  </gazebo>\r\n</robot>\n'})}),"\n",(0,t.jsx)(r.h2,{id:"step-3-create-a-gazebo-world-file",children:"Step 3: Create a Gazebo World File"}),"\n",(0,t.jsx)(r.p,{children:"Create the worlds directory and a simple world file:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"mkdir -p ~/ros2_simulation_ws/src/robot_simulation_pkg/worlds\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/worlds/simple_room.world"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:'<?xml version="1.0" ?>\r\n<sdf version="1.7">\r\n  <world name="simple_room">\r\n    \x3c!-- Include ground plane --\x3e\r\n    <include>\r\n      <uri>model://ground_plane</uri>\r\n    </include>\r\n\r\n    \x3c!-- Include sun --\x3e\r\n    <include>\r\n      <uri>model://sun</uri>\r\n    </include>\r\n\r\n    \x3c!-- Simple room with walls --\x3e\r\n    <model name="wall_1">\r\n      <pose>-5 0 2.5 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>0.1 10 5</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>0.1 10 5</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.8 0.8 1</ambient>\r\n            <diffuse>0.8 0.8 0.8 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>100</mass>\r\n          <inertia>\r\n            <ixx>1</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>1</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>1</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n\r\n    <model name="wall_2">\r\n      <pose>5 0 2.5 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>0.1 10 5</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>0.1 10 5</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.8 0.8 1</ambient>\r\n            <diffuse>0.8 0.8 0.8 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>100</mass>\r\n          <inertia>\r\n            <ixx>1</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>1</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>1</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n\r\n    <model name="wall_3">\r\n      <pose>0 -5 2.5 0 0 1.5707</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>0.1 10 5</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>0.1 10 5</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.8 0.8 1</ambient>\r\n            <diffuse>0.8 0.8 0.8 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>100</mass>\r\n          <inertia>\r\n            <ixx>1</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>1</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>1</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n\r\n    <model name="wall_4">\r\n      <pose>0 5 2.5 0 0 1.5707</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>0.1 10 5</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>0.1 10 5</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.8 0.8 1</ambient>\r\n            <diffuse>0.8 0.8 0.8 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>100</mass>\r\n          <inertia>\r\n            <ixx>1</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>1</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>1</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n\r\n    \x3c!-- Add some obstacles --\x3e\r\n    <model name="obstacle_1">\r\n      <pose>2 2 0.5 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>1 1 1</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>1 1 1</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>1 0 0 1</ambient>\r\n            <diffuse>1 0 0 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>10</mass>\r\n          <inertia>\r\n            <ixx>1</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>1</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>1</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n\r\n    <model name="obstacle_2">\r\n      <pose>-2 -2 0.5 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <cylinder>\r\n              <radius>0.5</radius>\r\n              <length>1</length>\r\n            </cylinder>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <cylinder>\r\n              <radius>0.5</radius>\r\n              <length>1</length>\r\n            </cylinder>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0 1 0 1</ambient>\r\n            <diffuse>0 1 0 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>5</mass>\r\n          <inertia>\r\n            <ixx>1</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>1</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>1</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n\r\n    \x3c!-- Physics configuration --\x3e\r\n    <physics type="ode">\r\n      <max_step_size>0.001</max_step_size>\r\n      <real_time_factor>1</real_time_factor>\r\n      <real_time_update_rate>1000</real_time_update_rate>\r\n      <ode>\r\n        <solver>\r\n          <type>quick</type>\r\n          <iters>10</iters>\r\n          <sor>1.3</sor>\r\n        </solver>\r\n        <constraints>\r\n          <cfm>0.0</cfm>\r\n          <erp>0.2</erp>\r\n          <contact_max_correcting_vel>100.0</contact_max_correcting_vel>\r\n          <contact_surface_layer>0.001</contact_surface_layer>\r\n        </constraints>\r\n      </ode>\r\n    </physics>\r\n  </world>\r\n</sdf>\n'})}),"\n",(0,t.jsx)(r.h2,{id:"step-4-create-a-robot-state-publisher-node",children:"Step 4: Create a Robot State Publisher Node"}),"\n",(0,t.jsx)(r.p,{children:"Create a Python node to publish the robot state:"}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/robot_simulation_pkg/robot_state_publisher.py"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\r\n\"\"\"\r\nRobot State Publisher Node\r\nPublishes joint states for visualization\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import JointState\r\nfrom geometry_msgs.msg import TransformStamped\r\nfrom tf2_ros import TransformBroadcaster\r\nimport math\r\n\r\n\r\nclass RobotStatePublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('robot_state_publisher')\r\n\r\n        # Create publisher for joint states\r\n        self.joint_pub = self.create_publisher(JointState, 'joint_states', 10)\r\n\r\n        # Create transform broadcaster\r\n        self.tf_broadcaster = TransformBroadcaster(self)\r\n\r\n        # Create timer for publishing\r\n        self.timer = self.create_timer(0.05, self.publish_joint_states)  # 20 Hz\r\n\r\n        # Initialize joint positions\r\n        self.wheel_left_pos = 0.0\r\n        self.wheel_right_pos = 0.0\r\n\r\n        self.get_logger().info('Robot State Publisher started')\r\n\r\n    def publish_joint_states(self):\r\n        # Create joint state message\r\n        msg = JointState()\r\n        msg.name = ['base_to_left_wheel', 'base_to_right_wheel']\r\n        msg.position = [self.wheel_left_pos, self.wheel_right_pos]\r\n        msg.velocity = [0.0, 0.0]\r\n        msg.effort = [0.0, 0.0]\r\n\r\n        # Set timestamp\r\n        msg.header.stamp = self.get_clock().now().to_msg()\r\n        msg.header.frame_id = 'base_link'\r\n\r\n        # Publish joint states\r\n        self.joint_pub.publish(msg)\r\n\r\n        # Broadcast transforms\r\n        self.broadcast_transforms()\r\n\r\n        # Update wheel positions (simulated motion)\r\n        self.wheel_left_pos += 0.01\r\n        self.wheel_right_pos += 0.01\r\n\r\n    def broadcast_transforms(self):\r\n        # Publish transform for base_link to odom (if available)\r\n        try:\r\n            # This would come from odometry in a real system\r\n            t = TransformStamped()\r\n            t.header.stamp = self.get_clock().now().to_msg()\r\n            t.header.frame_id = 'odom'\r\n            t.child_frame_id = 'base_link'\r\n            t.transform.translation.x = 0.0\r\n            t.transform.translation.y = 0.0\r\n            t.transform.translation.z = 0.0\r\n            t.transform.rotation.x = 0.0\r\n            t.transform.rotation.y = 0.0\r\n            t.transform.rotation.z = 0.0\r\n            t.transform.rotation.w = 1.0\r\n\r\n            self.tf_broadcaster.sendTransform(t)\r\n        except Exception as e:\r\n            self.get_logger().warn(f'Could not broadcast transform: {e}')\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = RobotStatePublisher()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(r.h2,{id:"step-5-create-a-simple-controller-node",children:"Step 5: Create a Simple Controller Node"}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/robot_simulation_pkg/simple_controller.py"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\r\n\"\"\"\r\nSimple Controller Node\r\nSubscribes to velocity commands and publishes them to the robot\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nfrom sensor_msgs.msg import LaserScan\r\nimport math\r\n\r\n\r\nclass SimpleController(Node):\r\n    def __init__(self):\r\n        super().__init__('simple_controller')\r\n\r\n        # Create subscriber for velocity commands\r\n        self.cmd_sub = self.create_subscription(\r\n            Twist,\r\n            'cmd_vel',\r\n            self.cmd_vel_callback,\r\n            10\r\n        )\r\n\r\n        # Create subscriber for laser scan (for obstacle detection)\r\n        self.scan_sub = self.create_subscription(\r\n            LaserScan,\r\n            'scan',\r\n            self.scan_callback,\r\n            10\r\n        )\r\n\r\n        # Create publisher for velocity commands (in case we need to modify them)\r\n        self.cmd_pub = self.create_publisher(Twist, 'cmd_vel_out', 10)\r\n\r\n        # Parameters\r\n        self.declare_parameter('safety_distance', 0.5)\r\n        self.declare_parameter('max_linear_speed', 0.5)\r\n        self.declare_parameter('max_angular_speed', 1.0)\r\n\r\n        self.safety_distance = self.get_parameter('safety_distance').value\r\n        self.max_linear_speed = self.get_parameter('max_linear_speed').value\r\n        self.max_angular_speed = self.get_parameter('max_angular_speed').value\r\n\r\n        # Initialize variables\r\n        self.scan_data = None\r\n\r\n        self.get_logger().info('Simple Controller initialized')\r\n\r\n    def cmd_vel_callback(self, msg):\r\n        # Process the command (in this simple case, just log it)\r\n        self.get_logger().info(f'Received command: linear={msg.linear.x}, angular={msg.angular.z}')\r\n\r\n        # Check for obstacles and modify command if needed\r\n        if self.scan_data is not None:\r\n            modified_msg = self.avoid_obstacles(msg)\r\n            self.cmd_pub.publish(modified_msg)\r\n        else:\r\n            self.cmd_pub.publish(msg)\r\n\r\n    def scan_callback(self, msg):\r\n        # Store the latest scan data\r\n        self.scan_data = msg\r\n\r\n    def avoid_obstacles(self, original_cmd):\r\n        # Create a new command message\r\n        new_cmd = Twist()\r\n\r\n        # Check if there are obstacles in front\r\n        front_ranges = []\r\n        for i, distance in enumerate(self.scan_data.ranges):\r\n            if not math.isnan(distance) and not math.isinf(distance):\r\n                angle = self.scan_data.angle_min + i * self.scan_data.angle_increment\r\n                # Check front 60 degrees\r\n                if -math.pi/6 < angle < math.pi/6:\r\n                    front_ranges.append(distance)\r\n\r\n        if front_ranges and min(front_ranges) < self.safety_distance:\r\n            # Obstacle detected, stop and turn\r\n            new_cmd.linear.x = 0.0\r\n            new_cmd.angular.z = self.max_angular_speed\r\n            self.get_logger().warn(f'Obstacle detected at {min(front_ranges):.2f}m, turning!')\r\n        else:\r\n            # Path is clear, follow original command but with speed limits\r\n            new_cmd.linear.x = max(-self.max_linear_speed, min(self.max_linear_speed, original_cmd.linear.x))\r\n            new_cmd.angular.z = max(-self.max_angular_speed, min(self.max_angular_speed, original_cmd.angular.z))\r\n\r\n        return new_cmd\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = SimpleController()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(r.h2,{id:"step-6-create-launch-files",children:"Step 6: Create Launch Files"}),"\n",(0,t.jsx)(r.p,{children:"Create the launch directory:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"mkdir -p ~/ros2_simulation_ws/src/robot_simulation_pkg/launch\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"~/ros2_simulation_ws/src/robot_simulation_pkg/launch/robot_simulation.launch.py"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"from launch import LaunchDescription\r\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription, ExecuteProcess\r\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution, TextSubstitution\r\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\r\nfrom launch_ros.actions import Node\r\nfrom ament_index_python.packages import get_package_share_directory\r\nimport os\r\n\r\n\r\ndef generate_launch_description():\r\n    # Package directory\r\n    pkg_dir = get_package_share_directory('robot_simulation_pkg')\r\n\r\n    # Launch arguments\r\n    use_sim_time = DeclareLaunchArgument(\r\n        'use_sim_time',\r\n        default_value='true',\r\n        description='Use simulation (Gazebo) clock if true'\r\n    )\r\n\r\n    world = DeclareLaunchArgument(\r\n        'world',\r\n        default_value='simple_room.world',\r\n        description='Choose one of the world files from `/robot_simulation_pkg/worlds`'\r\n    )\r\n\r\n    # Launch Gazebo server\r\n    gzserver = ExecuteProcess(\r\n        cmd=['gz', 'sim', '-r', PathJoinSubstitution([pkg_dir, 'worlds', LaunchConfiguration('world')])],\r\n        output='screen'\r\n    )\r\n\r\n    # Launch Gazebo client\r\n    gzclient = ExecuteProcess(\r\n        cmd=['gz', 'sim', '-g'],\r\n        output='screen'\r\n    )\r\n\r\n    # Robot State Publisher node\r\n    robot_state_publisher = Node(\r\n        package='robot_state_publisher',\r\n        executable='robot_state_publisher',\r\n        name='robot_state_publisher',\r\n        output='screen',\r\n        parameters=[{\r\n            'use_sim_time': LaunchConfiguration('use_sim_time'),\r\n            'robot_description': open(PathJoinSubstitution([pkg_dir, 'urdf', 'my_robot.urdf']).perform({})).read()\r\n        }]\r\n    )\r\n\r\n    # Spawn robot in Gazebo\r\n    spawn_entity = Node(\r\n        package='gazebo_ros',\r\n        executable='spawn_entity.py',\r\n        arguments=[\r\n            '-topic', 'robot_description',\r\n            '-entity', 'my_robot',\r\n            '-x', '0', '-y', '0', '-z', '0.1'\r\n        ],\r\n        output='screen'\r\n    )\r\n\r\n    # Robot State Publisher node (custom)\r\n    custom_robot_state_publisher = Node(\r\n        package='robot_simulation_pkg',\r\n        executable='robot_state_publisher',\r\n        name='custom_robot_state_publisher',\r\n        output='screen',\r\n        parameters=[{'use_sim_time': LaunchConfiguration('use_sim_time')}]\r\n    )\r\n\r\n    # Simple controller node\r\n    simple_controller = Node(\r\n        package='robot_simulation_pkg',\r\n        executable='simple_controller',\r\n        name='simple_controller',\r\n        output='screen',\r\n        parameters=[\r\n            {'use_sim_time': LaunchConfiguration('use_sim_time')},\r\n            {'safety_distance': 0.5},\r\n            {'max_linear_speed': 0.5},\r\n            {'max_angular_speed': 1.0}\r\n        ]\r\n    )\r\n\r\n    return LaunchDescription([\r\n        use_sim_time,\r\n        world,\r\n        gzserver,\r\n        # gzclient,  # Uncomment if you want the GUI\r\n        robot_state_publisher,\r\n        spawn_entity,\r\n        custom_robot_state_publisher,\r\n        simple_controller\r\n    ])\n"})}),"\n",(0,t.jsx)(r.h2,{id:"step-7-update-setuppy",children:"Step 7: Update setup.py"}),"\n",(0,t.jsxs)(r.p,{children:["Update the ",(0,t.jsx)(r.code,{children:"setup.py"})," file to include entry points:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"from setuptools import setup\r\n\r\npackage_name = 'robot_simulation_pkg'\r\n\r\nsetup(\r\n    name=package_name,\r\n    version='0.0.0',\r\n    packages=[package_name],\r\n    data_files=[\r\n        ('share/ament_index/resource_index/packages',\r\n            ['resource/' + package_name]),\r\n        ('share/' + package_name, ['package.xml']),\r\n        ('share/' + package_name + '/urdf', ['urdf/my_robot.urdf']),\r\n        ('share/' + package_name + '/worlds', ['worlds/simple_room.world']),\r\n        ('share/' + package_name + '/launch', ['launch/robot_simulation.launch.py']),\r\n    ],\r\n    install_requires=['setuptools'],\r\n    zip_safe=True,\r\n    maintainer='Your Name',\r\n    maintainer_email='your.email@example.com',\r\n    description='Robot simulation package for lab exercise',\r\n    license='Apache License 2.0',\r\n    tests_require=['pytest'],\r\n    entry_points={\r\n        'console_scripts': [\r\n            'robot_state_publisher = robot_simulation_pkg.robot_state_publisher:main',\r\n            'simple_controller = robot_simulation_pkg.simple_controller:main',\r\n        ],\r\n    },\r\n)\n"})}),"\n",(0,t.jsx)(r.h2,{id:"step-8-build-and-run-the-simulation",children:"Step 8: Build and Run the Simulation"}),"\n",(0,t.jsx)(r.p,{children:"Build your package:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"cd ~/ros2_simulation_ws\r\ncolcon build --packages-select robot_simulation_pkg\r\nsource install/setup.bash\n"})}),"\n",(0,t.jsx)(r.p,{children:"Run the simulation:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Terminal 1: Launch the simulation\r\nros2 launch robot_simulation_pkg robot_simulation.launch.py\r\n\r\n# Terminal 2: Send velocity commands (after simulation is running)\r\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.5}, angular: {z: 0.2}}'\n"})}),"\n",(0,t.jsx)(r.h2,{id:"step-9-test-and-monitor",children:"Step 9: Test and Monitor"}),"\n",(0,t.jsx)(r.p,{children:"Monitor various topics to see the simulation in action:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Check joint states\r\nros2 topic echo /joint_states\r\n\r\n# Check odometry\r\nros2 topic echo /odom\r\n\r\n# Check laser scan data\r\nros2 topic echo /scan\r\n\r\n# Check TF transforms\r\nros2 run tf2_tools view_frames\n"})}),"\n",(0,t.jsx)(r.h2,{id:"step-10-advanced-testing",children:"Step 10: Advanced Testing"}),"\n",(0,t.jsx)(r.p,{children:"Try different commands to see how the robot responds:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Move forward\r\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.5}, angular: {z: 0.0}}' --times 10\r\n\r\n# Turn in place\r\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.0}, angular: {z: 0.5}}' --times 10\r\n\r\n# Square pattern\r\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.5}, angular: {z: 0.0}}' --times 10\r\nsleep 2\r\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.0}, angular: {z: 0.5}}' --times 10\n"})}),"\n",(0,t.jsx)(r.h2,{id:"expected-results",children:"Expected Results"}),"\n",(0,t.jsx)(r.p,{children:"When you run the simulation:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"The Gazebo environment should start with your robot model"}),"\n",(0,t.jsx)(r.li,{children:"The robot should appear in the simple room world with walls and obstacles"}),"\n",(0,t.jsx)(r.li,{children:"When you send velocity commands, the robot should move in Gazebo"}),"\n",(0,t.jsx)(r.li,{children:"The robot should publish odometry data showing its position and orientation"}),"\n",(0,t.jsx)(r.li,{children:"The obstacle avoidance controller should respond to laser scan data"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(r.p,{children:"If you encounter issues:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Model not appearing"}),": Check that the URDF is valid and the spawn command is correct"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"No movement"}),": Verify that the differential drive plugin is properly configured"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"TF errors"}),": Ensure the robot_state_publisher is running"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Gazebo crashes"}),": Try reducing physics complexity or increasing resources"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"extensions",children:"Extensions"}),"\n",(0,t.jsx)(r.p,{children:"To extend this simulation:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Add sensors"}),": Include camera, IMU, or other sensor models in the URDF"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Improve obstacle avoidance"}),": Implement more sophisticated navigation algorithms"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Add more complex environments"}),": Create larger, more detailed worlds"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Implement SLAM"}),": Add mapping and localization capabilities"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(r.p,{children:"In this lab, you have successfully:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Created a complete robot model in URDF format"}),"\n",(0,t.jsx)(r.li,{children:"Set up a Gazebo simulation environment"}),"\n",(0,t.jsx)(r.li,{children:"Implemented a basic control system with obstacle avoidance"}),"\n",(0,t.jsx)(r.li,{children:"Connected ROS 2 nodes to the simulation"}),"\n",(0,t.jsx)(r.li,{children:"Tested the system with various commands"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"This provides a foundation for more complex robotic simulation scenarios and demonstrates the integration between ROS 2 and Gazebo for robotics development."})]})}function d(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>o});var i=n(6540);const t={},s=i.createContext(t);function a(e){const r=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:r},e.children)}}}]);