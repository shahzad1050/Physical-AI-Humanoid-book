"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[9001],{8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>i});var a=s(6540);const r={},t=a.createContext(r);function l(e){const n=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),a.createElement(t.Provider,{value:n},e.children)}},9624:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"module1/lab-first-application","title":"Practical Lab: Building Your First ROS 2 Application","description":"Objective","source":"@site/docs/module1/lab-first-application.md","sourceDirName":"module1","slug":"/module1/lab-first-application","permalink":"/Physical-AI-Humanoid-book/docs/module1/lab-first-application","draft":false,"unlisted":false,"editUrl":"https://github.com/user/physical-ai-humanoid-robotics/tree/main/docs/module1/lab-first-application.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Module 1: The Robotic Nervous System (ROS 2)","permalink":"/Physical-AI-Humanoid-book/docs/module1/"},"next":{"title":"Launch Files and Parameter Management","permalink":"/Physical-AI-Humanoid-book/docs/module1/launch-files-parameters"}}');var r=s(4848),t=s(8453);const l={},i="Practical Lab: Building Your First ROS 2 Application",o={},c=[{value:"Objective",id:"objective",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create a New ROS 2 Package",id:"step-1-create-a-new-ros-2-package",level:2},{value:"Step 2: Create the Publisher Node",id:"step-2-create-the-publisher-node",level:2},{value:"Step 3: Create the Subscriber Node",id:"step-3-create-the-subscriber-node",level:2},{value:"Step 4: Create a Launch File",id:"step-4-create-a-launch-file",level:2},{value:"Step 5: Update setup.py",id:"step-5-update-setuppy",level:2},{value:"Step 6: Build and Run",id:"step-6-build-and-run",level:2},{value:"Step 7: Monitor the System",id:"step-7-monitor-the-system",level:2},{value:"Step 8: Experiment with Parameters",id:"step-8-experiment-with-parameters",level:2},{value:"Expected Results",id:"expected-results",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Summary",id:"summary",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"practical-lab-building-your-first-ros-2-application",children:"Practical Lab: Building Your First ROS 2 Application"})}),"\n",(0,r.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,r.jsx)(n.p,{children:"In this lab, you will create a complete ROS 2 application that demonstrates the core concepts of nodes, topics, publishers, subscribers, and parameters. By the end of this lab, you will have built a simple robot controller that publishes sensor data and responds to commands."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ROS 2 installed (Humble Hawksbill or later recommended)"}),"\n",(0,r.jsx)(n.li,{children:"Python 3.8 or higher"}),"\n",(0,r.jsx)(n.li,{children:"Basic Python programming knowledge"}),"\n",(0,r.jsx)(n.li,{children:"Terminal/command line familiarity"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-1-create-a-new-ros-2-package",children:"Step 1: Create a New ROS 2 Package"}),"\n",(0,r.jsx)(n.p,{children:"First, create a new workspace and package for your application:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Create workspace directory\nmkdir -p ~/ros2_labs/src\ncd ~/ros2_labs/src\n\n# Create a new package\nros2 pkg create --build-type ament_python robot_controller_pkg --dependencies rclpy std_msgs geometry_msgs sensor_msgs\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-2-create-the-publisher-node",children:"Step 2: Create the Publisher Node"}),"\n",(0,r.jsxs)(n.p,{children:["Create a file ",(0,r.jsx)(n.code,{children:"~/ros2_labs/src/robot_controller_pkg/robot_controller_pkg/sensor_publisher.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\n\"\"\"\nSensor Publisher Node\nPublishes simulated sensor data (laser scan and IMU)\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import LaserScan\nfrom sensor_msgs.msg import Imu\nfrom std_msgs.msg import Float32\nimport math\nimport random\n\n\nclass SensorPublisher(Node):\n    def __init__(self):\n        super().__init__('sensor_publisher')\n\n        # Create publishers\n        self.laser_pub = self.create_publisher(LaserScan, 'laser_scan', 10)\n        self.imu_pub = self.create_publisher(Imu, 'imu_data', 10)\n        self.battery_pub = self.create_publisher(Float32, 'battery_level', 10)\n\n        # Declare parameters\n        self.declare_parameter('publish_rate', 10.0)\n        self.declare_parameter('sensor_range', 10.0)\n\n        # Get parameter values\n        self.rate = self.get_parameter('publish_rate').value\n        self.range = self.get_parameter('sensor_range').value\n\n        # Create timer\n        self.timer = self.create_timer(1.0 / self.rate, self.publish_sensor_data)\n\n        self.get_logger().info(f'Sensor publisher started with rate: {self.rate}Hz')\n\n    def publish_sensor_data(self):\n        # Publish laser scan\n        laser_msg = LaserScan()\n        laser_msg.header.stamp = self.get_clock().now().to_msg()\n        laser_msg.header.frame_id = 'laser_frame'\n        laser_msg.angle_min = -math.pi / 2\n        laser_msg.angle_max = math.pi / 2\n        laser_msg.angle_increment = math.pi / 180  # 1 degree\n        laser_msg.time_increment = 0.0\n        laser_msg.scan_time = 1.0 / self.rate\n        laser_msg.range_min = 0.1\n        laser_msg.range_max = self.range\n\n        # Generate simulated laser data\n        num_readings = int((laser_msg.angle_max - laser_msg.angle_min) / laser_msg.angle_increment) + 1\n        laser_msg.ranges = []\n        for i in range(num_readings):\n            # Simulate some obstacles at specific angles\n            angle = laser_msg.angle_min + i * laser_msg.angle_increment\n            distance = self.range  # Default: no obstacle\n            if -0.5 < angle < 0.5:  # Front obstacle\n                distance = 2.0 + random.uniform(-0.2, 0.2)\n            elif 0.8 < abs(angle) < 1.2:  # Side obstacles\n                distance = 3.0 + random.uniform(-0.3, 0.3)\n            laser_msg.ranges.append(distance)\n\n        self.laser_pub.publish(laser_msg)\n\n        # Publish IMU data\n        imu_msg = Imu()\n        imu_msg.header.stamp = self.get_clock().now().to_msg()\n        imu_msg.header.frame_id = 'imu_frame'\n\n        # Simulate slight orientation changes\n        imu_msg.orientation.x = random.uniform(-0.01, 0.01)\n        imu_msg.orientation.y = random.uniform(-0.01, 0.01)\n        imu_msg.orientation.z = random.uniform(-0.01, 0.01)\n        imu_msg.orientation.w = 1.0  # Normalize\n\n        # Simulate small angular velocities\n        imu_msg.angular_velocity.x = random.uniform(-0.001, 0.001)\n        imu_msg.angular_velocity.y = random.uniform(-0.001, 0.001)\n        imu_msg.angular_velocity.z = random.uniform(-0.001, 0.001)\n\n        # Simulate linear accelerations\n        imu_msg.linear_acceleration.x = random.uniform(-0.1, 0.1)\n        imu_msg.linear_acceleration.y = random.uniform(-0.1, 0.1)\n        imu_msg.linear_acceleration.z = 9.8 + random.uniform(-0.1, 0.1)  # Gravity\n\n        self.imu_pub.publish(imu_msg)\n\n        # Publish battery level\n        battery_msg = Float32()\n        battery_msg.data = max(0.0, 100.0 - (self.get_clock().now().nanoseconds / 1e9) % 100.0)\n        self.battery_pub.publish(battery_msg)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    sensor_publisher = SensorPublisher()\n\n    try:\n        rclpy.spin(sensor_publisher)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        sensor_publisher.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-3-create-the-subscriber-node",children:"Step 3: Create the Subscriber Node"}),"\n",(0,r.jsxs)(n.p,{children:["Create a file ",(0,r.jsx)(n.code,{children:"~/ros2_labs/src/robot_controller_pkg/robot_controller_pkg/command_subscriber.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\n\"\"\"\nCommand Subscriber Node\nSubscribes to sensor data and publishes commands\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom sensor_msgs.msg import LaserScan, Imu\nfrom std_msgs.msg import Float32\nimport math\n\n\nclass CommandSubscriber(Node):\n    def __init__(self):\n        super().__init__('command_subscriber')\n\n        # Create publisher for robot commands\n        self.cmd_pub = self.create_publisher(Twist, 'cmd_vel', 10)\n\n        # Create subscribers\n        self.laser_sub = self.create_subscription(LaserScan, 'laser_scan', self.laser_callback, 10)\n        self.imu_sub = self.create_subscription(Imu, 'imu_data', self.imu_callback, 10)\n        self.battery_sub = self.create_subscription(Float32, 'battery_level', self.battery_callback, 10)\n\n        # Declare parameters\n        self.declare_parameter('safety_distance', 1.0)\n        self.declare_parameter('max_linear_velocity', 0.5)\n        self.declare_parameter('max_angular_velocity', 1.0)\n\n        # Get parameter values\n        self.safety_distance = self.get_parameter('safety_distance').value\n        self.max_linear = self.get_parameter('max_linear_velocity').value\n        self.max_angular = self.get_parameter('max_angular_velocity').value\n\n        # Initialize sensor data storage\n        self.laser_data = None\n        self.imu_data = None\n        self.battery_level = 100.0\n\n        # Create timer for command generation\n        self.timer = self.create_timer(0.1, self.generate_command)\n\n        self.get_logger().info('Command subscriber initialized')\n\n    def laser_callback(self, msg):\n        self.laser_data = msg\n        self.get_logger().debug(f'Laser data received, {len(msg.ranges)} ranges')\n\n    def imu_callback(self, msg):\n        self.imu_data = msg\n        # Log orientation (simplified)\n        self.get_logger().debug(f'IMU orientation: ({msg.orientation.x:.3f}, {msg.orientation.y:.3f})')\n\n    def battery_callback(self, msg):\n        self.battery_level = msg.data\n        if self.battery_level < 20.0:\n            self.get_logger().warn(f'Low battery: {self.battery_level:.1f}%')\n\n    def generate_command(self):\n        if self.laser_data is None:\n            return  # Wait for laser data\n\n        # Create command message\n        cmd_msg = Twist()\n\n        # Check for obstacles in front\n        front_ranges = []\n        for i, distance in enumerate(self.laser_data.ranges):\n            angle = self.laser_data.angle_min + i * self.laser_data.angle_increment\n            if -0.5 < angle < 0.5:  # Front 60-degree sector\n                if not math.isnan(distance) and distance < self.safety_distance:\n                    front_ranges.append(distance)\n\n        if front_ranges and min(front_ranges) < self.safety_distance:\n            # Obstacle detected, turn away\n            cmd_msg.linear.x = 0.0\n            cmd_msg.angular.z = self.max_angular if min(front_ranges) < self.safety_distance * 0.7 else self.max_angular / 2\n            self.get_logger().info(f'Obstacle detected! Distance: {min(front_ranges):.2f}, turning')\n        else:\n            # Clear path, move forward\n            cmd_msg.linear.x = self.max_linear\n            cmd_msg.angular.z = 0.0\n\n        # Publish command\n        self.cmd_pub.publish(cmd_msg)\n\n        # Log current state\n        self.get_logger().info(\n            f'Cmd: linear={cmd_msg.linear.x:.2f}, angular={cmd_msg.angular.z:.2f}, '\n            f'battery={self.battery_level:.1f}%'\n        )\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    command_subscriber = CommandSubscriber()\n\n    try:\n        rclpy.spin(command_subscriber)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        command_subscriber.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-4-create-a-launch-file",children:"Step 4: Create a Launch File"}),"\n",(0,r.jsx)(n.p,{children:"Create a launch directory and file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_labs/src/robot_controller_pkg/launch\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_labs/src/robot_controller_pkg/launch/robot_system.launch.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument\nfrom launch.substitutions import LaunchConfiguration\nfrom launch_ros.actions import Node\n\n\ndef generate_launch_description():\n    # Declare launch arguments\n    use_sim_time = DeclareLaunchArgument(\n        'use_sim_time',\n        default_value='false',\n        description='Use simulation time if true'\n    )\n\n    publish_rate = DeclareLaunchArgument(\n        'publish_rate',\n        default_value='10.0',\n        description='Sensor publishing rate'\n    )\n\n    safety_distance = DeclareLaunchArgument(\n        'safety_distance',\n        default_value='1.0',\n        description='Minimum safe distance'\n    )\n\n    return LaunchDescription([\n        use_sim_time,\n        publish_rate,\n        safety_distance,\n\n        # Sensor publisher node\n        Node(\n            package='robot_controller_pkg',\n            executable='sensor_publisher',\n            name='sensor_publisher',\n            parameters=[\n                {'publish_rate': LaunchConfiguration('publish_rate')},\n                {'sensor_range': 10.0}\n            ],\n            output='screen'\n        ),\n\n        # Command subscriber node\n        Node(\n            package='robot_controller_pkg',\n            executable='command_subscriber',\n            name='command_subscriber',\n            parameters=[\n                {'safety_distance': LaunchConfiguration('safety_distance')},\n                {'max_linear_velocity': 0.5},\n                {'max_angular_velocity': 1.0}\n            ],\n            output='screen'\n        )\n    ])\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-5-update-setuppy",children:"Step 5: Update setup.py"}),"\n",(0,r.jsxs)(n.p,{children:["Update the ",(0,r.jsx)(n.code,{children:"setup.py"})," file in your package to include entry points:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from setuptools import setup\n\npackage_name = 'robot_controller_pkg'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        ('share/' + package_name + '/launch', ['launch/robot_system.launch.py']),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='your.email@example.com',\n    description='Robot controller package for lab exercise',\n    license='Apache License 2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'sensor_publisher = robot_controller_pkg.sensor_publisher:main',\n            'command_subscriber = robot_controller_pkg.command_subscriber:main',\n        ],\n    },\n)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-6-build-and-run",children:"Step 6: Build and Run"}),"\n",(0,r.jsx)(n.p,{children:"Build your package:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_labs\ncolcon build --packages-select robot_controller_pkg\nsource install/setup.bash\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run the system:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Option 1: Run the launch file\nros2 launch robot_controller_pkg robot_system.launch.py\n\n# Option 2: Run nodes separately\n# Terminal 1:\nros2 run robot_controller_pkg sensor_publisher\n\n# Terminal 2:\nros2 run robot_controller_pkg command_subscriber\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-7-monitor-the-system",children:"Step 7: Monitor the System"}),"\n",(0,r.jsx)(n.p,{children:"In another terminal, monitor the topics:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# List active topics\nros2 topic list\n\n# Echo laser scan data\nros2 topic echo /laser_scan\n\n# Echo robot commands\nros2 topic echo /cmd_vel\n\n# Check parameters\nros2 param list /command_subscriber\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-8-experiment-with-parameters",children:"Step 8: Experiment with Parameters"}),"\n",(0,r.jsx)(n.p,{children:"Try changing parameters while the system is running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Change safety distance\nros2 param set /command_subscriber safety_distance 2.0\n\n# Change publish rate\nros2 param set /sensor_publisher publish_rate 20.0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"expected-results",children:"Expected Results"}),"\n",(0,r.jsx)(n.p,{children:"When you run the system:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"The sensor publisher should publish laser scan, IMU, and battery data"}),"\n",(0,r.jsx)(n.li,{children:"The command subscriber should process the sensor data and generate appropriate commands"}),"\n",(0,r.jsx)(n.li,{children:"When obstacles are detected in front of the robot, it should turn to avoid them"}),"\n",(0,r.jsx)(n.li,{children:"The robot should continue moving forward when the path is clear"}),"\n",(0,r.jsx)(n.li,{children:"Low battery warnings should appear when the simulated battery level drops"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.p,{children:"If you encounter issues:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Package not found"}),": Make sure you sourced the setup file after building"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node not launching"}),": Check that entry points are correctly defined in setup.py"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"No communication"}),": Verify that both nodes are on the same ROS domain"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Permission errors"}),": Ensure your Python files have execute permissions"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"In this lab, you have:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Created a ROS 2 package with multiple nodes"}),"\n",(0,r.jsx)(n.li,{children:"Implemented publisher and subscriber nodes"}),"\n",(0,r.jsx)(n.li,{children:"Used parameters for configuration"}),"\n",(0,r.jsx)(n.li,{children:"Created a launch file to run the complete system"}),"\n",(0,r.jsx)(n.li,{children:"Monitored and modified parameters at runtime"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This exercise demonstrates the core concepts of ROS 2: nodes, topics, parameters, and launch files. You've built a simple but complete robotic system that processes sensor data and generates appropriate commands based on that data."})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}}}]);