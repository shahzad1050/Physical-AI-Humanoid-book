"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[9001],{8453:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>i});var s=n(6540);const a={},t=s.createContext(a);function l(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),s.createElement(t.Provider,{value:r},e.children)}},9624:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"module1/lab-first-application","title":"Practical Lab: Building Your First ROS 2 Application","description":"Objective","source":"@site/docs/module1/lab-first-application.md","sourceDirName":"module1","slug":"/module1/lab-first-application","permalink":"/Physical-AI-Humanoid-book/docs/module1/lab-first-application","draft":false,"unlisted":false,"editUrl":"https://github.com/user/physical-ai-humanoid-robotics/tree/main/docs/module1/lab-first-application.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Module 1: The Robotic Nervous System (ROS 2)","permalink":"/Physical-AI-Humanoid-book/docs/module1/"},"next":{"title":"Launch Files and Parameter Management","permalink":"/Physical-AI-Humanoid-book/docs/module1/launch-files-parameters"}}');var a=n(4848),t=n(8453);const l={},i="Practical Lab: Building Your First ROS 2 Application",o={},c=[{value:"Objective",id:"objective",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create a New ROS 2 Package",id:"step-1-create-a-new-ros-2-package",level:2},{value:"Step 2: Create the Publisher Node",id:"step-2-create-the-publisher-node",level:2},{value:"Step 3: Create the Subscriber Node",id:"step-3-create-the-subscriber-node",level:2},{value:"Step 4: Create a Launch File",id:"step-4-create-a-launch-file",level:2},{value:"Step 5: Update setup.py",id:"step-5-update-setuppy",level:2},{value:"Step 6: Build and Run",id:"step-6-build-and-run",level:2},{value:"Step 7: Monitor the System",id:"step-7-monitor-the-system",level:2},{value:"Step 8: Experiment with Parameters",id:"step-8-experiment-with-parameters",level:2},{value:"Expected Results",id:"expected-results",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Summary",id:"summary",level:2}];function m(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"practical-lab-building-your-first-ros-2-application",children:"Practical Lab: Building Your First ROS 2 Application"})}),"\n",(0,a.jsx)(r.h2,{id:"objective",children:"Objective"}),"\n",(0,a.jsx)(r.p,{children:"In this lab, you will create a complete ROS 2 application that demonstrates the core concepts of nodes, topics, publishers, subscribers, and parameters. By the end of this lab, you will have built a simple robot controller that publishes sensor data and responds to commands."}),"\n",(0,a.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"ROS 2 installed (Humble Hawksbill or later recommended)"}),"\n",(0,a.jsx)(r.li,{children:"Python 3.8 or higher"}),"\n",(0,a.jsx)(r.li,{children:"Basic Python programming knowledge"}),"\n",(0,a.jsx)(r.li,{children:"Terminal/command line familiarity"}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"step-1-create-a-new-ros-2-package",children:"Step 1: Create a New ROS 2 Package"}),"\n",(0,a.jsx)(r.p,{children:"First, create a new workspace and package for your application:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"# Create workspace directory\r\nmkdir -p ~/ros2_labs/src\r\ncd ~/ros2_labs/src\r\n\r\n# Create a new package\r\nros2 pkg create --build-type ament_python robot_controller_pkg --dependencies rclpy std_msgs geometry_msgs sensor_msgs\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-2-create-the-publisher-node",children:"Step 2: Create the Publisher Node"}),"\n",(0,a.jsxs)(r.p,{children:["Create a file ",(0,a.jsx)(r.code,{children:"~/ros2_labs/src/robot_controller_pkg/robot_controller_pkg/sensor_publisher.py"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\r\n\"\"\"\r\nSensor Publisher Node\r\nPublishes simulated sensor data (laser scan and IMU)\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import LaserScan\r\nfrom sensor_msgs.msg import Imu\r\nfrom std_msgs.msg import Float32\r\nimport math\r\nimport random\r\n\r\n\r\nclass SensorPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('sensor_publisher')\r\n\r\n        # Create publishers\r\n        self.laser_pub = self.create_publisher(LaserScan, 'laser_scan', 10)\r\n        self.imu_pub = self.create_publisher(Imu, 'imu_data', 10)\r\n        self.battery_pub = self.create_publisher(Float32, 'battery_level', 10)\r\n\r\n        # Declare parameters\r\n        self.declare_parameter('publish_rate', 10.0)\r\n        self.declare_parameter('sensor_range', 10.0)\r\n\r\n        # Get parameter values\r\n        self.rate = self.get_parameter('publish_rate').value\r\n        self.range = self.get_parameter('sensor_range').value\r\n\r\n        # Create timer\r\n        self.timer = self.create_timer(1.0 / self.rate, self.publish_sensor_data)\r\n\r\n        self.get_logger().info(f'Sensor publisher started with rate: {self.rate}Hz')\r\n\r\n    def publish_sensor_data(self):\r\n        # Publish laser scan\r\n        laser_msg = LaserScan()\r\n        laser_msg.header.stamp = self.get_clock().now().to_msg()\r\n        laser_msg.header.frame_id = 'laser_frame'\r\n        laser_msg.angle_min = -math.pi / 2\r\n        laser_msg.angle_max = math.pi / 2\r\n        laser_msg.angle_increment = math.pi / 180  # 1 degree\r\n        laser_msg.time_increment = 0.0\r\n        laser_msg.scan_time = 1.0 / self.rate\r\n        laser_msg.range_min = 0.1\r\n        laser_msg.range_max = self.range\r\n\r\n        # Generate simulated laser data\r\n        num_readings = int((laser_msg.angle_max - laser_msg.angle_min) / laser_msg.angle_increment) + 1\r\n        laser_msg.ranges = []\r\n        for i in range(num_readings):\r\n            # Simulate some obstacles at specific angles\r\n            angle = laser_msg.angle_min + i * laser_msg.angle_increment\r\n            distance = self.range  # Default: no obstacle\r\n            if -0.5 < angle < 0.5:  # Front obstacle\r\n                distance = 2.0 + random.uniform(-0.2, 0.2)\r\n            elif 0.8 < abs(angle) < 1.2:  # Side obstacles\r\n                distance = 3.0 + random.uniform(-0.3, 0.3)\r\n            laser_msg.ranges.append(distance)\r\n\r\n        self.laser_pub.publish(laser_msg)\r\n\r\n        # Publish IMU data\r\n        imu_msg = Imu()\r\n        imu_msg.header.stamp = self.get_clock().now().to_msg()\r\n        imu_msg.header.frame_id = 'imu_frame'\r\n\r\n        # Simulate slight orientation changes\r\n        imu_msg.orientation.x = random.uniform(-0.01, 0.01)\r\n        imu_msg.orientation.y = random.uniform(-0.01, 0.01)\r\n        imu_msg.orientation.z = random.uniform(-0.01, 0.01)\r\n        imu_msg.orientation.w = 1.0  # Normalize\r\n\r\n        # Simulate small angular velocities\r\n        imu_msg.angular_velocity.x = random.uniform(-0.001, 0.001)\r\n        imu_msg.angular_velocity.y = random.uniform(-0.001, 0.001)\r\n        imu_msg.angular_velocity.z = random.uniform(-0.001, 0.001)\r\n\r\n        # Simulate linear accelerations\r\n        imu_msg.linear_acceleration.x = random.uniform(-0.1, 0.1)\r\n        imu_msg.linear_acceleration.y = random.uniform(-0.1, 0.1)\r\n        imu_msg.linear_acceleration.z = 9.8 + random.uniform(-0.1, 0.1)  # Gravity\r\n\r\n        self.imu_pub.publish(imu_msg)\r\n\r\n        # Publish battery level\r\n        battery_msg = Float32()\r\n        battery_msg.data = max(0.0, 100.0 - (self.get_clock().now().nanoseconds / 1e9) % 100.0)\r\n        self.battery_pub.publish(battery_msg)\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    sensor_publisher = SensorPublisher()\r\n\r\n    try:\r\n        rclpy.spin(sensor_publisher)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        sensor_publisher.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-3-create-the-subscriber-node",children:"Step 3: Create the Subscriber Node"}),"\n",(0,a.jsxs)(r.p,{children:["Create a file ",(0,a.jsx)(r.code,{children:"~/ros2_labs/src/robot_controller_pkg/robot_controller_pkg/command_subscriber.py"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\r\n\"\"\"\r\nCommand Subscriber Node\r\nSubscribes to sensor data and publishes commands\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nfrom sensor_msgs.msg import LaserScan, Imu\r\nfrom std_msgs.msg import Float32\r\nimport math\r\n\r\n\r\nclass CommandSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('command_subscriber')\r\n\r\n        # Create publisher for robot commands\r\n        self.cmd_pub = self.create_publisher(Twist, 'cmd_vel', 10)\r\n\r\n        # Create subscribers\r\n        self.laser_sub = self.create_subscription(LaserScan, 'laser_scan', self.laser_callback, 10)\r\n        self.imu_sub = self.create_subscription(Imu, 'imu_data', self.imu_callback, 10)\r\n        self.battery_sub = self.create_subscription(Float32, 'battery_level', self.battery_callback, 10)\r\n\r\n        # Declare parameters\r\n        self.declare_parameter('safety_distance', 1.0)\r\n        self.declare_parameter('max_linear_velocity', 0.5)\r\n        self.declare_parameter('max_angular_velocity', 1.0)\r\n\r\n        # Get parameter values\r\n        self.safety_distance = self.get_parameter('safety_distance').value\r\n        self.max_linear = self.get_parameter('max_linear_velocity').value\r\n        self.max_angular = self.get_parameter('max_angular_velocity').value\r\n\r\n        # Initialize sensor data storage\r\n        self.laser_data = None\r\n        self.imu_data = None\r\n        self.battery_level = 100.0\r\n\r\n        # Create timer for command generation\r\n        self.timer = self.create_timer(0.1, self.generate_command)\r\n\r\n        self.get_logger().info('Command subscriber initialized')\r\n\r\n    def laser_callback(self, msg):\r\n        self.laser_data = msg\r\n        self.get_logger().debug(f'Laser data received, {len(msg.ranges)} ranges')\r\n\r\n    def imu_callback(self, msg):\r\n        self.imu_data = msg\r\n        # Log orientation (simplified)\r\n        self.get_logger().debug(f'IMU orientation: ({msg.orientation.x:.3f}, {msg.orientation.y:.3f})')\r\n\r\n    def battery_callback(self, msg):\r\n        self.battery_level = msg.data\r\n        if self.battery_level < 20.0:\r\n            self.get_logger().warn(f'Low battery: {self.battery_level:.1f}%')\r\n\r\n    def generate_command(self):\r\n        if self.laser_data is None:\r\n            return  # Wait for laser data\r\n\r\n        # Create command message\r\n        cmd_msg = Twist()\r\n\r\n        # Check for obstacles in front\r\n        front_ranges = []\r\n        for i, distance in enumerate(self.laser_data.ranges):\r\n            angle = self.laser_data.angle_min + i * self.laser_data.angle_increment\r\n            if -0.5 < angle < 0.5:  # Front 60-degree sector\r\n                if not math.isnan(distance) and distance < self.safety_distance:\r\n                    front_ranges.append(distance)\r\n\r\n        if front_ranges and min(front_ranges) < self.safety_distance:\r\n            # Obstacle detected, turn away\r\n            cmd_msg.linear.x = 0.0\r\n            cmd_msg.angular.z = self.max_angular if min(front_ranges) < self.safety_distance * 0.7 else self.max_angular / 2\r\n            self.get_logger().info(f'Obstacle detected! Distance: {min(front_ranges):.2f}, turning')\r\n        else:\r\n            # Clear path, move forward\r\n            cmd_msg.linear.x = self.max_linear\r\n            cmd_msg.angular.z = 0.0\r\n\r\n        # Publish command\r\n        self.cmd_pub.publish(cmd_msg)\r\n\r\n        # Log current state\r\n        self.get_logger().info(\r\n            f'Cmd: linear={cmd_msg.linear.x:.2f}, angular={cmd_msg.angular.z:.2f}, '\r\n            f'battery={self.battery_level:.1f}%'\r\n        )\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    command_subscriber = CommandSubscriber()\r\n\r\n    try:\r\n        rclpy.spin(command_subscriber)\r\n    except KeyboardInterrupt:\r\n        pass\r\n    finally:\r\n        command_subscriber.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-4-create-a-launch-file",children:"Step 4: Create a Launch File"}),"\n",(0,a.jsx)(r.p,{children:"Create a launch directory and file:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"mkdir -p ~/ros2_labs/src/robot_controller_pkg/launch\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Create ",(0,a.jsx)(r.code,{children:"~/ros2_labs/src/robot_controller_pkg/launch/robot_system.launch.py"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:"from launch import LaunchDescription\r\nfrom launch.actions import DeclareLaunchArgument\r\nfrom launch.substitutions import LaunchConfiguration\r\nfrom launch_ros.actions import Node\r\n\r\n\r\ndef generate_launch_description():\r\n    # Declare launch arguments\r\n    use_sim_time = DeclareLaunchArgument(\r\n        'use_sim_time',\r\n        default_value='false',\r\n        description='Use simulation time if true'\r\n    )\r\n\r\n    publish_rate = DeclareLaunchArgument(\r\n        'publish_rate',\r\n        default_value='10.0',\r\n        description='Sensor publishing rate'\r\n    )\r\n\r\n    safety_distance = DeclareLaunchArgument(\r\n        'safety_distance',\r\n        default_value='1.0',\r\n        description='Minimum safe distance'\r\n    )\r\n\r\n    return LaunchDescription([\r\n        use_sim_time,\r\n        publish_rate,\r\n        safety_distance,\r\n\r\n        # Sensor publisher node\r\n        Node(\r\n            package='robot_controller_pkg',\r\n            executable='sensor_publisher',\r\n            name='sensor_publisher',\r\n            parameters=[\r\n                {'publish_rate': LaunchConfiguration('publish_rate')},\r\n                {'sensor_range': 10.0}\r\n            ],\r\n            output='screen'\r\n        ),\r\n\r\n        # Command subscriber node\r\n        Node(\r\n            package='robot_controller_pkg',\r\n            executable='command_subscriber',\r\n            name='command_subscriber',\r\n            parameters=[\r\n                {'safety_distance': LaunchConfiguration('safety_distance')},\r\n                {'max_linear_velocity': 0.5},\r\n                {'max_angular_velocity': 1.0}\r\n            ],\r\n            output='screen'\r\n        )\r\n    ])\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-5-update-setuppy",children:"Step 5: Update setup.py"}),"\n",(0,a.jsxs)(r.p,{children:["Update the ",(0,a.jsx)(r.code,{children:"setup.py"})," file in your package to include entry points:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-python",children:"from setuptools import setup\r\n\r\npackage_name = 'robot_controller_pkg'\r\n\r\nsetup(\r\n    name=package_name,\r\n    version='0.0.0',\r\n    packages=[package_name],\r\n    data_files=[\r\n        ('share/ament_index/resource_index/packages',\r\n            ['resource/' + package_name]),\r\n        ('share/' + package_name, ['package.xml']),\r\n        ('share/' + package_name + '/launch', ['launch/robot_system.launch.py']),\r\n    ],\r\n    install_requires=['setuptools'],\r\n    zip_safe=True,\r\n    maintainer='Your Name',\r\n    maintainer_email='your.email@example.com',\r\n    description='Robot controller package for lab exercise',\r\n    license='Apache License 2.0',\r\n    tests_require=['pytest'],\r\n    entry_points={\r\n        'console_scripts': [\r\n            'sensor_publisher = robot_controller_pkg.sensor_publisher:main',\r\n            'command_subscriber = robot_controller_pkg.command_subscriber:main',\r\n        ],\r\n    },\r\n)\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-6-build-and-run",children:"Step 6: Build and Run"}),"\n",(0,a.jsx)(r.p,{children:"Build your package:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"cd ~/ros2_labs\r\ncolcon build --packages-select robot_controller_pkg\r\nsource install/setup.bash\n"})}),"\n",(0,a.jsx)(r.p,{children:"Run the system:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"# Option 1: Run the launch file\r\nros2 launch robot_controller_pkg robot_system.launch.py\r\n\r\n# Option 2: Run nodes separately\r\n# Terminal 1:\r\nros2 run robot_controller_pkg sensor_publisher\r\n\r\n# Terminal 2:\r\nros2 run robot_controller_pkg command_subscriber\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-7-monitor-the-system",children:"Step 7: Monitor the System"}),"\n",(0,a.jsx)(r.p,{children:"In another terminal, monitor the topics:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"# List active topics\r\nros2 topic list\r\n\r\n# Echo laser scan data\r\nros2 topic echo /laser_scan\r\n\r\n# Echo robot commands\r\nros2 topic echo /cmd_vel\r\n\r\n# Check parameters\r\nros2 param list /command_subscriber\n"})}),"\n",(0,a.jsx)(r.h2,{id:"step-8-experiment-with-parameters",children:"Step 8: Experiment with Parameters"}),"\n",(0,a.jsx)(r.p,{children:"Try changing parameters while the system is running:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"# Change safety distance\r\nros2 param set /command_subscriber safety_distance 2.0\r\n\r\n# Change publish rate\r\nros2 param set /sensor_publisher publish_rate 20.0\n"})}),"\n",(0,a.jsx)(r.h2,{id:"expected-results",children:"Expected Results"}),"\n",(0,a.jsx)(r.p,{children:"When you run the system:"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsx)(r.li,{children:"The sensor publisher should publish laser scan, IMU, and battery data"}),"\n",(0,a.jsx)(r.li,{children:"The command subscriber should process the sensor data and generate appropriate commands"}),"\n",(0,a.jsx)(r.li,{children:"When obstacles are detected in front of the robot, it should turn to avoid them"}),"\n",(0,a.jsx)(r.li,{children:"The robot should continue moving forward when the path is clear"}),"\n",(0,a.jsx)(r.li,{children:"Low battery warnings should appear when the simulated battery level drops"}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(r.p,{children:"If you encounter issues:"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Package not found"}),": Make sure you sourced the setup file after building"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Node not launching"}),": Check that entry points are correctly defined in setup.py"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"No communication"}),": Verify that both nodes are on the same ROS domain"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Permission errors"}),": Ensure your Python files have execute permissions"]}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(r.p,{children:"In this lab, you have:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Created a ROS 2 package with multiple nodes"}),"\n",(0,a.jsx)(r.li,{children:"Implemented publisher and subscriber nodes"}),"\n",(0,a.jsx)(r.li,{children:"Used parameters for configuration"}),"\n",(0,a.jsx)(r.li,{children:"Created a launch file to run the complete system"}),"\n",(0,a.jsx)(r.li,{children:"Monitored and modified parameters at runtime"}),"\n"]}),"\n",(0,a.jsx)(r.p,{children:"This exercise demonstrates the core concepts of ROS 2: nodes, topics, parameters, and launch files. You've built a simple but complete robotic system that processes sensor data and generates appropriate commands based on that data."})]})}function d(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}}}]);